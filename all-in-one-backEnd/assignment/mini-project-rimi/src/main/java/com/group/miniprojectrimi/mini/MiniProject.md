## 미니 프로젝트 가이드 (진도표 8일차 시작)

우리는 이제 트랜잭션이 무엇이고,  
왜 사용해야 하는지 그리고 JPA 영속성 컨텍스트의 신기한 기능들은 무엇이 있는지 배워보았습니다 🙂  
이제 우리는 [과제]를 통한 문제 풀이 대신,  [미니 프로젝트]를 진행할 수 있습니다!!! 👏👏   
강의에서 다루었던 내용을 익힐 수 있도록 한 두 번 복습해보시고,  
남은 시간에는 [미니 프로젝트]를 통해 추가적인 성장을 이뤄내보세요! 🔥

---

##### [미니 프로젝트 설명]

미니 프로젝트는 자바 17로 진행됩니다.  
오늘은 IntelliJ에서 자바 17과 11을 바꿔 가며 사용하는 방법을 확인하고 연습해 보시는 것을 추천 드립니다.  
<52강. Spring Boot 2.7.x에서 3.0.x로 업데이트하기>를 미리 시청하셔도 좋습니다! 😊  
또한, `jenv`와 같은 몇 가지 도구를 검색해보셔도 좋습니다.

<미니 프로젝트>는 자바와 스프링 부트를 이용해 밑바닥부터 작은 애플리케이션을 개발해 나가는 경험을 담고 있습니다.  
이 애플리케이션은 <자바와 스프링 부트로 생애 최초 서버 만들기> 강의 보다는 약간 더 어렵고,  
기업에서 이루어지는 파일럿 프로젝트 보다는 더 쉽게 구성되어 있습니다. 😊

<미니 프로젝트>는 3단계로 이루어져 있으며, 각 단계별로 요구되는 기능을 구현하시면 됩니다.

##### <미니 프로젝트>에서 사용될 기술 스택은 다음과 같습니다.

- 자바 17 버전
- Spring boot 3.0.1 버전
- JPA
- MySQL

<미니 프로젝트>에서는 간단한 출퇴근 사내 시스템을 만들어 가게 됩니다. 화면까지 개발할 필요는 없고,  
각 기능을 담당하는 API가 있어, API의 역할을 설명할 수 있다면 충분합니다.

예를 들어

```
# 직원 저장 기능 (POST/member)을 사용하면 직원이 데이터베이스에 저장되는데, 이렇게 저장된 직원은
직원 조회 기능 (GET/member)을 통해 확인할 수 있습니다.
```

---

## [프로젝트 1단계]

- 프로젝트 최초 설정이 이루어져야 합니다.
    - (스프링 부트를 시작하는 첫 번째 방법을 떠올려보세요.)

아래는 구현되어야 하는 기능입니다.

- 팀 등록 기능
    - 회사에 있는 팀을 등록할 수 있어야 합니다. 팀이 가져야할 필수 정보는 다음과 같습니다.
    - ```팀이름```


- 직원 등록 기능
    - 직원을 등록할 수 있어야 합니다. 직원이 가져야할 필수 정보는 다음과 같습니다.
    - ```직원이름```
    - ```팀의 매니저인지 매니저가 아닌지 여부```
    - ```회사에 들어온 일자```
    - ```생일```


- 팀 조회 기능
    - 모든 팀의 정보를 한 번에 조회할 수 있어야 합니다.

```
[
    {
        "name": "팀 이름",
        "manager": "팀 매니저 이름", //없을 경우 null
        "memberCount": 팀 인원 수 [숫자]
    }, ...
]
```

- 직원 조회 기능
    - 모든 직원의 정보를 한 번에 조회할 수 있어야 합니다.

```
[
    {
        "name": "직원 이름",
        "teamName": "소속 팀 이름",
        "role": "MANAGER" or "MEMBER", // 팀의 매니저인지 아닌지
        "birthday": "1989-01-01",
        "workStartDate": "2024-01-01"
    }, ...
]
```

---

## [프로젝트 2단계]

프로젝트 1단계에서는 가장 기초 정보인 팀과 직원을 설정하고 조회할 수 있도록 개발했습니다.  
이제 2단계에서는 등록된 직원들이 출근과 퇴근을 할수 있는 기능을 만들어 봅시다!

- 출근 기능
    - 등록된 직원은 출근을 할 수 있어야 한다. 출근의 경우 이름은 동명이인이 있을 수 있으므로, DB에 등록된 ```id```를 기준으로 처리된다.


- 퇴근 기능
    - 출근한 직원은 퇴근을 할 수 있어야 한다. 퇴근 역시 DB에 등록된 ```id```를 기준으로 처리된다.


- 특정 직원의 날짜별 근무시간을 조회하는 기능
    - 특정 직원 ```id```와 ```2024-01``` 과 같이 연/월을 받으면, 날짜별 근무 시간과 총 합을 반환해야 한다. 이때 근무 시간은 분단위로 계산된다.
    - 예를 들어 ```1번```id를 갖는 직원에 대해 ```2024-01``` 을 기준으로 조회하면, 다음과 같이 응답이 반환되어야 한다.

```
{
    "detail": [
        {
            "date": "2024-01-01,
            "workingMinutes": 480
        },
        {
            "date": "2024-01-02,
            "workingMinutes": 490
        },
        ... // 2024년 1월 31일까지 존재할 수 있다.
    ]
    "sum": 10560
}
```

```
# 한 걸음 더!
백엔드 개발을 하다보면 필연적으로 다양한 경우를 생각해야 합니다. 또한 쉽게 생각하기 어려운 edge-case는
기획자가 미처 고려하지 못하더라도 개발자가 직접 생각해서 협의해야 하는 경우도 많죠.

위 기능에 대해 다음 경우를 고민해보세요!
- 등록되지 않은 직원이 출근을 하려는 경우
- 출근한 직원이 또 다시 출근을 하는 경우
- 퇴근하려는 직원이 출근하지 않았던 경우
- 그 날, 출근했다 퇴근한 직원이 다시 출근하려는 경우
```

---

## [프로젝트 3단계]

프로젝트 2단계를 통해 우리는 매우 간단한 출퇴근 시스템을 만들었습니다.  
하지만 아직 직원들이 휴가를 쓸 수는 없습니다.  
어서 휴가(연차) 기능을 만들어 봅시다.

- 연차 신청
    - 이제부터 직원은 연차를 신청할 수 있습니다.
    - 연차는 무조건 하루 단위로만 사용이 가능합니다.
    - 올해 입사한 직원은 11개의 연차를, 그 외 직원은 15개의 연차를 사용할 수 있습니다.
    - 연차를 사용하기 위해서는 연차 사용일을 기준으로 며칠전 ```연차등록```을 해야 합니다. 연차를 등록하기만 하면 매니저의 허가 없이 연차가 바로 적용됩니다.
        - 단, 며칠 전에 연차를 등록해야 하는지는 팀 마다 다르게 적용됩니다.
        - 예를 들어 A팀은 하루 전에만 등록하면 연차를 사용할 수 있지만, B팀은 7일 전에 등록해야 연차를 사용할 수 있습니다.


- 연차 조회
    - 각 직원은 ``id``를 이용해 올해 사용하지 않고 남은 연차를 확인할 수 있습니다.


- 특정 직원의 날짜별 근무시간을 조회하는 기능 V2
    - 연차를 신청할 수 있게 되며, <프로젝트 2단계>에서 개발했던 기능도 조금 변경되어야 합니다.
    - 만약 연차를 사용했다면, ```usingDayOff : true```가 반환되어야 합니다.

```
{
    "detail": [
        {
            "date": "2024-01-01,
            "workingMinutes": 480,
            "usingDayOff": false // 연차를 사용하지 않았으니 false가 반환
        },
        {
            "date": "2024-01-02,
            "workingMinutes": 0,
            "usingDayOff": true // 연차를 사용한 날은 true가 반환
        },
        ... // 2024년 1월 31일까지 존재할 수 있다.
    ]
    "sum": 10560
}
```

---

## [프로젝트 4단계]

우리가 개발한 시스템에는 중요한 기능이 한 가지 빠져 있습니다. 바로 초과 근무 계산 기능이죠!!  
프로젝트 4단계에서는 초과 근무 계산 기능을 만들어 보도록 하겠습니다.  
또한 이렇게 구성한 프로젝트를 AWS에 배포해보도록 하겠습니다.

```
# AWS 비용이 걱정되신다면, free tier로 사용하고 계신 EC2를 사용하지면 좋습니다.
예를 들어, <자바의 스프링 부트로 생애 최초 서버 만들기> 배포 연습을 마무리 하시고,
해당 EC2를 제거하신 다음 새로운 free tier EC2를 만드시면 free tier 사용을 극대화 할 수 있습니다.
```

- 초과 근무 계산
    - 모든 직원은 하루 근무 8시간을 기준으로 근로 계약을 맺고 있습니다.
    - 근무 시간은 주말과 법정 공휴일을 제외하고 계산되어야 합니다.
    - 2024년 1월을 예로 들어보면, 전체 근무일은 22일로 토/일과 1월1일 공휴일 1일이 빠진 수치입니다. (31-8-1=22) 따라서 176시간이 기준 근무 시간이 됩니다.
    - 초과 근무 계산 API ```2024-01```과 같이 연/월을 받아 모든 직원이 초과 근무 시간을 분단위로 계산해주어야 합니다. 예를 들어 데이터는 다음과 같이 생일 수 있습니다.

```
[
    {
        "id": 1,
        "name": "김*수",
        "overtimeMinutes": 120 // 2024년 1월에 2시간을 초과 근무한 직원
    },
    {
        "id": 2,
        "name": "이*희",
        "overtimeMinutes": 0 // 2024년 1월에 2시간을 초과 근무를 하지 않는 직원
    }
    ...
]
```

```
# 한 걸음 더
회사 사장님께서 매달 1일 오전, 이전달의 초과 근무 계산 결과를 csv 혹은 엑셀 형태로 받아 보고 싶다고 하시는군요!
해당 기능을 어떻게 만들 수 있을까요?
```

- 시스템 배포하기
    - 우리가 지금까지 개발한 시스템을 배포해보도록 하겠습니다!
    - 기존에 사용한 방식을 그대로 쓰셔도 좋고, free tier RDS를 적용하셔도 좋습니다

```
# 한 걸음 더

현재는 배포를 하기 위해

1) EC2에 접속하여
2) 변경된 코드 내용을 "git pull" 명령어로 가져온 다음
3) jar 파일을 직접 빌드하고
4) 기존 자바 프로세스를 제거하고
5) 새로 빌드한 jar 파일을 실행시키는

과정을 거치고 있습니다.
이 과정을 어떻게 하면 자동화를 할 수 있을까요?!
기존 배포 방법의 단점은 없을까요?!
```

---